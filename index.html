<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- iOS fullscreen web app support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="OneLess">

  <title>OneLess Vending Machine</title>
  <style>
    :root{
      --green:#20543c;
      --bg:#000;
      --card:#fff;
      --text:#111;
      --muted:#444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background:var(--bg);
      height:100vh;
      display:grid;
      place-items:center;
    }
    .vending-container{
      width: 812px;
      height: 375px;
      background: var(--green);
      border-radius:24px;
      padding: 16px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .screen,.welcome-screen{
      width: 100%;
      height: 100%;
      background: var(--card);
      color: var(--text);
      border-radius: 16px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
    }

    /* --- Welcome screen --- */
    .welcome-screen{
      background: var(--green);
      color:#fff;
      cursor:pointer;
    }
    .split{
      display:flex;
      justify-content:space-between;
      align-items:center;
      width:100%;
      height:100%;
      gap:30px;
      padding: 20px;
    }
    .split-left,.split-right{
      flex:1;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      text-align:center;
    }
    .welcome-logo {
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .circle-logo {
      background:#fff;
      border-radius:50%;
      width:216px;
      height:216px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
    }
    .circle-text {
      font-weight:800;
      font-size:50px;
      line-height:1.05;
    }
    .circle-text.one { color: var(--green); }
    .circle-text.less { color:#000; margin-top:-6px; }
    .welcome-instr{
      font-size:26px;
      color:#fff;
      font-weight:700;
      margin:10px 0;
      white-space:nowrap;
      transform:translateX(-20px);
    }
    .welcome-tap{
      font-size:24px;
      font-weight:700;
      margin-top:15px;
      color:#fff;
      transform:translateX(-20px);
    }

    /* --- Other journey --- */
    h2{margin:0 0 16px 0;font-size:24px}
    p{margin:8px 0 0 0;font-size:18px;color:var(--muted)}
    .btn, .keypad button{
      appearance:none;
      border:0;
      background: var(--green);
      color:#fff;
      font-weight:700;
      border-radius:10px;
      height: 52px;
      font-size:18px;
      cursor:pointer;
    }
    .btn-secondary{ background:#18402d }

    .product-screen{
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      flex:1;
    }
    .product-screen h2{ font-size:29px; }
    .product-buttons{
      display:flex;
      gap:30px;
      margin-top:20px;
    }
    .product-buttons button{
      width: 216px;
      height: 84px;
      font-size:26px;
      border-radius:14px;
    }

    .payment-buttons button{
      width: 280px;
      height: 84px;
      font-size:26px;
      border-radius:14px;
      white-space:nowrap;
    }

    .amount-display{
      font-size:48px;
      font-weight:800;
      margin-top:10px;
    }
    .price-display{
      font-size:40px;
      font-weight:800;
      color:var(--green);
      margin-top:12px;
    }
    .price-hint{
      font-size:18px;
      color:var(--muted);
      margin-top:4px;
    }
    .keypad{
      display:grid;
      grid-template-columns: repeat(3, 90px);
      gap:12px;
    }
    .keypad button{ height:60px; font-size:20px; font-weight:700 }

    .price-summary h2{ font-size:29px; }
    .price-summary p{ font-size:22px; }
    .price-summary button{
      width: 216px;
      height: 84px;
      font-size:26px;
    }

    .confirm-order h2{ font-size:29px; }
    .confirm-order p{ font-size:22px; }
    .confirm-order button{
      width: 216px;
      height: 84px;
      font-size:26px;
    }

    /* Striped animated progress bar */
    .progress{
      width: 80%;
      max-width: 520px;
      height: 28px;
      background: #e9ecef;
      border-radius: 999px;
      overflow:hidden;
      border:1px solid #d6d6d6;
    }
    .progress-bar{
      height: 100%;
      width: 0%;
      background: repeating-linear-gradient(
        -45deg,
        #2e7d57,
        #2e7d57 10px,
        #20543c 10px,
        #20543c 20px
      );
      background-size: 40px 40px;
      animation: progress-stripes 1s linear infinite;
      transition: width .2s ease;
    }
    @keyframes progress-stripes {
      from { background-position: 0 0; }
      to   { background-position: 40px 0; }
    }
    .progress-label{ margin-top:8px; font-weight:700; color:var(--muted) }

    /* Final screen */
    .final{
      background: var(--green);
      color:#fff;
      border-radius:16px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      flex:1;
      cursor:pointer;
      opacity:0;
      animation: fadeIn 1s forwards;
    }
    .final h2{
      font-size:48px;
      margin-bottom:20px;
    }
    .final p{
      font-size:28px;
      line-height:1.5;
      color:#fff;
    }
    @keyframes fadeIn {
      from { opacity:0; }
      to { opacity:1; }
    }
  </style>
</head>
<body>
  <div class="vending-container">
    <div class="welcome-screen" id="welcome" onclick="playClick(); startMachine()">
      <div class="split">
        <div class="split-left">
          <div class="welcome-logo">
            <div class="circle-logo">
              <div class="circle-text one">ONE</div>
              <div class="circle-text less">LESS</div>
            </div>
          </div>
        </div>
        <div class="split-right">
          <div class="welcome-instr">Put your bottle on the refill area</div>
          <div class="welcome-tap">Tap to continue</div>
        </div>
      </div>
    </div>
    <div class="screen" id="screen" style="display:none;"></div>
  </div>

  <!-- Load sounds -->
  <audio id="clickSound" src="click.wav" preload="auto"></audio>
  <audio id="refillSound" src="refill.wav" preload="auto"></audio>

  <script>
    let inputAmount = "";
    let productType = "";
    let paymentMethod = "";

    const clickSound = document.getElementById('clickSound');
    const refillSound = document.getElementById('refillSound');

    function playClick(){ clickSound.currentTime = 0; clickSound.play(); }
    function playRefill(){ refillSound.currentTime = 0; refillSound.play(); }

    function startMachine(){
      document.getElementById('welcome').style.display='none';
      const s=document.getElementById('screen');
      s.style.display='flex';
      s.classList.remove('final'); 
      resetMachine();
    }

    function resetMachine(){
      inputAmount=""; productType=""; paymentMethod="";
      const s=document.getElementById('screen');
      s.innerHTML =
        '<div class="product-screen">' +
          '<h2>Select Product</h2>' +
          '<div class="product-buttons">' +
            '<button class="btn" onclick="playClick(); selectProduct(\'Shampoo\')">Shampoo</button>' +
            '<button class="btn" onclick="playClick(); selectProduct(\'Body Wash\')">Body Wash</button>' +
          '</div>' +
        '</div>';
    }

    function selectProduct(type){
      productType = type;
      showAmountInput();
    }

    function showAmountInput(){
      const s=document.getElementById('screen');
      s.innerHTML =
        '<div class="split">' +
          '<div class="split-left">' +
            '<h2>Enter Amount (L)</h2>' +
            '<div class="price-hint">Price: NZ$5 per litre</div>' +
            '<div class="amount-display" id="amount">0</div>' +
            '<div class="price-display" id="price">NZ$ 0</div>' +
          '</div>' +
          '<div class="split-right">' +
            '<div class="keypad">' +
              '<button onclick="playClick(); appendNumber(\'1\')">1</button>' +
              '<button onclick="playClick(); appendNumber(\'2\')">2</button>' +
              '<button onclick="playClick(); appendNumber(\'3\')">3</button>' +
              '<button onclick="playClick(); appendNumber(\'4\')">4</button>' +
              '<button onclick="playClick(); appendNumber(\'5\')">5</button>' +
              '<button onclick="playClick(); appendNumber(\'6\')">6</button>' +
              '<button onclick="playClick(); appendNumber(\'7\')">7</button>' +
              '<button onclick="playClick(); appendNumber(\'8\')">8</button>' +
              '<button onclick="playClick(); appendNumber(\'9\')">9</button>' +
              '<button onclick="playClick(); deleteNumber()">Del</button>' +
              '<button onclick="playClick(); appendNumber(\'0\')">0</button>' +
              '<button class="btn-secondary" onclick="playClick(); showPrice()">Next</button>' +
            '</div>' +
          '</div>' +
        '</div>';
    }

    function appendNumber(n){
      if(inputAmount.length < 3){
        inputAmount += n;
        document.getElementById('amount').textContent = inputAmount;
        updatePrice();
      }
    }

    function deleteNumber(){
      inputAmount = inputAmount.slice(0,-1);
      document.getElementById('amount').textContent = inputAmount || "0";
      updatePrice();
    }

    function updatePrice(){
      const litres = parseInt(inputAmount, 10) || 0;
      const price = litres * 5;
      document.getElementById('price').textContent = "NZ$ " + price;
    }

    function showPrice(){
      if(inputAmount === "") { alert("Enter amount first."); return; }
      const price = (parseInt(inputAmount,10) || 0) * 5;
      const s=document.getElementById('screen');
      s.innerHTML =
        '<div class="split price-summary">' +
          '<div class="split-left"><h2>Price Summary</h2></div>' +
          '<div class="split-right" style="gap:16px;">' +
            '<p><strong>' + inputAmount + ' L</strong> of <strong>' + productType + '</strong></p>' +
            '<p>Total: <strong>NZ$ ' + price + '</strong></p>' +
            '<button class="btn" onclick="playClick(); goToPayment()">Continue to Payment</button>' +
          '</div>' +
        '</div>';
    }

    function goToPayment(){
      const s=document.getElementById('screen');
      s.innerHTML =
        '<div class="split">' +
          '<div class="split-left"><h2 style="font-size:29px;">Select Payment</h2></div>' +
          '<div class="split-right payment-buttons" style="gap:20px;">' +
            '<button class="btn" onclick="playClick(); selectPayment(\'Debit/Credit Card\')">Debit/Credit Card</button>' +
            '<button class="btn" onclick="playClick(); selectPayment(\'Mobile Payment\')">Mobile Payment</button>' +
          '</div>' +
        '</div>';
    }

    function selectPayment(method){
      paymentMethod = method;
      showConfirmation();
    }

    function showConfirmation(){
      const price = (parseInt(inputAmount,10) || 0) * 5;
      const s=document.getElementById('screen');
      s.innerHTML =
        '<div class="split confirm-order">' +
          '<div class="split-left"><h2>Confirm Order</h2></div>' +
          '<div class="split-right" style="gap:16px;">' +
            '<p><strong>' + inputAmount + ' L</strong> of <strong>' + productType + '</strong></p>' +
            '<p>Price: <strong>NZ$ ' + price + '</strong></p>' +
            '<p>Payment: <strong>' + paymentMethod + '</strong></p>' +
            '<button class="btn" onclick="playClick(); startRefill()">Confirm &amp; Refill</button>' +
          '</div>' +
        '</div>';
    }

    function startRefill(){
      playRefill();
      const s=document.getElementById('screen');
      s.innerHTML =
        '<div style="display:flex;flex-direction:column;align-items:center;gap:12px;width:100%;">' +
          '<h2>Refilling…</h2>' +
          '<div class="progress"><div class="progress-bar" id="bar"></div></div>' +
          '<div class="progress-label" id="pct">0%</div>' +
          '<p style="margin-top:12px;">Hold your bottle steady.</p>' +
        '</div>';

      let pct = 0;
      const bar = document.getElementById('bar');
      const label = document.getElementById('pct');

      const t = setInterval(()=>{
        pct += 5;
        if(pct > 100) pct = 100;
        bar.style.width = pct + "%";
        label.textContent = pct + "%";
        if(pct === 100){
          clearInterval(t);
          setTimeout(showThankYou, 1000); // 1s delay
        }
      }, 150);
    }

    function showThankYou(){
      const s=document.getElementById('screen');
      s.classList.add('final');
      s.innerHTML =
        '<div>' +
          '<h2>♻️ Nice work!</h2>' +
          '<p>You have just avoided <strong>1 plastic bottle</strong><br/>and about <strong>0.12 kg CO₂e</strong>.</p>' +
        '</div>';
      // tap anywhere to return to welcome
      s.onclick = () => {
        s.style.display="none";
        s.classList.remove('final'); 
        document.getElementById('welcome').style.display="flex";
      }
    }
  </script>
</body>
</html>
